[Rank 0] 2025-07-23 03:16:03,796 - INFO - âœ… Using BLIP3-o recall evaluator as default
[Rank 0] 2025-07-23 03:16:03,797 - INFO - BLIP3-o evaluation utilities loaded successfully
[Rank 0] 2025-07-23 03:16:06,579 - INFO - BLIP3-o configurations loaded successfully
[Rank 0] 2025-07-23 03:16:06,579 - INFO -   âœ… Memory optimization features available
[Rank 0] 2025-07-23 03:16:06,579 - INFO - âœ… BLIP3-o patch-level DiT model loaded successfully
[Rank 0] 2025-07-23 03:16:06,579 - INFO - âœ… Using BLIP3-o patch-level DiT model as primary model
[Rank 0] 2025-07-23 03:16:06,579 - INFO - BLIP3-o patch-level DiT model loaded successfully - Paper-aligned architecture
[Rank 0] 2025-07-23 03:16:06,580 - INFO - âœ… BLIP3-o patch-level flow matching loss loaded successfully
[Rank 0] 2025-07-23 03:16:06,581 - INFO - âœ… Using BLIP3-o patch-level flow matching loss as primary loss
[Rank 0] 2025-07-23 03:16:06,581 - INFO - BLIP3-o patch-level flow matching loss loaded successfully - Paper-aligned training
[Rank 0] 2025-07-23 03:16:07,274 - INFO - PyTorch version 2.7.1 available.
[Rank 0] 2025-07-23 03:16:07,491 - INFO - âœ… Using BLIP3-o patch-level trainer as default
[Rank 0] 2025-07-23 03:16:07,492 - INFO - BLIP3-o patch-level trainer loaded successfully - Paper-aligned training
[Rank 0] 2025-07-23 03:16:07,493 - INFO - âœ… Using enhanced DDP dataloaders with gradient flow as default
[Rank 0] 2025-07-23 03:16:07,493 - INFO - BLIP3-o datasets loaded successfully with gradient flow (default: enhanced_ddp_gradient_flow)
[Rank 0] 2025-07-23 03:16:07,493 - INFO - âœ… Gradient flow setup is active and ready for training
[Rank 0] 2025-07-23 03:16:09,794 - INFO - âœ… BLIP3-o Patch DiT model created (Paper-aligned)
[Rank 0] 2025-07-23 03:16:09,796 - INFO -    Parameters: 224,425,984
[Rank 0] 2025-07-23 03:16:09,796 - INFO -    Architecture: Lumina-Next based DiT
[Rank 0] 2025-07-23 03:16:09,796 - INFO -    Features: 3D RoPE, RMSNorm, SwiGLU, AdaLN
[Rank 0] 2025-07-23 03:16:09,796 - INFO -    Training: Flow matching on CLIP features
[Rank 0] 2025-07-23 03:16:09,889 - INFO - âœ… BLIP3-o Flow Matching Loss initialized
[Rank 0] 2025-07-23 03:16:09,889 - INFO -    Prediction type: velocity
[Rank 0] 2025-07-23 03:16:09,890 - INFO -    Contrastive loss: True
[Rank 0] 2025-07-23 03:16:09,890 - INFO -    Training objective: Patch-level flow matching
[Rank 0] 2025-07-23 03:16:09,890 - INFO - Creating standard dataloaders with gradient flow support
[Rank 0] 2025-07-23 03:16:09,890 - INFO - Loaded manifest: 30 shards, 78,475 samples
[Rank 0] 2025-07-23 03:16:09,891 - INFO - Found 30 shard files:
[Rank 0] 2025-07-23 03:16:09,891 - INFO -   embeddings_shard_00000.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,891 - INFO -   embeddings_shard_00001.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,891 - INFO -   embeddings_shard_00002.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,891 - INFO -   embeddings_shard_00003.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00004.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00005.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00006.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00007.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00008.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00009.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00010.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00011.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,892 - INFO -   embeddings_shard_00012.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00013.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00014.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00015.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00016.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00017.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00018.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00019.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,893 - INFO -   embeddings_shard_00020.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00021.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00022.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00023.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00024.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00025.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00026.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00027.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00028.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,894 - INFO -   embeddings_shard_00029.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,895 - INFO - Prepared 27 shard files for train split
[Rank 0] 2025-07-23 03:16:09,895 - INFO - Single-node mode:
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Total samples: 78,475
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Split samples (train): 70,627
[Rank 0] 2025-07-23 03:16:09,895 - INFO - ChunkedDataset initialized:
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Directory: /scratch-shared/scur2711/blip3o_workspace/embeddings/chunked_256_tokens
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Split: train
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Total shards: 27
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Estimated samples: 70,627
[Rank 0] 2025-07-23 03:16:09,895 - INFO -   Delete after use: False
[Rank 0] 2025-07-23 03:16:09,895 - INFO - Loaded manifest: 30 shards, 78,475 samples
[Rank 0] 2025-07-23 03:16:09,896 - INFO - Found 30 shard files:
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00000.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00001.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00002.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00003.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00004.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00005.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00006.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00007.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00008.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00009.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00010.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00011.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00012.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00013.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00014.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00015.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00016.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00017.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00018.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00019.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00020.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00021.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00022.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00023.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00024.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00025.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,896 - INFO -   embeddings_shard_00026.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   embeddings_shard_00027.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   embeddings_shard_00028.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   embeddings_shard_00029.pkl (EXISTS)
[Rank 0] 2025-07-23 03:16:09,897 - INFO - Prepared 3 shard files for eval split
[Rank 0] 2025-07-23 03:16:09,897 - INFO - Single-node mode:
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Total samples: 78,475
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Split samples (eval): 7,847
[Rank 0] 2025-07-23 03:16:09,897 - INFO - ChunkedDataset initialized:
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Directory: /scratch-shared/scur2711/blip3o_workspace/embeddings/chunked_256_tokens
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Split: eval
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Total shards: 3
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Estimated samples: 7,847
[Rank 0] 2025-07-23 03:16:09,897 - INFO -   Delete after use: False
[Rank 0] 2025-07-23 03:16:09,897 - INFO - Adjusted save_steps to 660 to be compatible with eval_steps 220
[Rank 0] 2025-07-23 03:16:17,088 - INFO - CLIP text encoder loaded successfully
[Rank 0] 2025-07-23 03:16:17,092 - INFO - BLIP3-o Recall Evaluator initialized
[Rank 0] 2025-07-23 03:16:17,092 - INFO - Device: cuda:0
[Rank 0] 2025-07-23 03:16:17,092 - INFO - Normalize embeddings: True
[Rank 0] 2025-07-23 03:16:17,092 - INFO - âœ… Recall evaluator initialized
[Rank 0] 2025-07-23 03:16:17,092 - INFO - âœ… BLIP3-o Fixed Patch Trainer initialized
[Rank 0] 2025-07-23 03:16:17,092 - INFO - ðŸŽ¯ Training mode: Fixed gradient flow patch-level flow matching
[Rank 0] 2025-07-23 03:16:17,092 - INFO - ðŸ“Š Recall evaluation: enabled
[Rank 0] 2025-07-23 03:16:30,275 - INFO - Loaded shard 1/27: 2630 samples
[Rank 0] 2025-07-23 03:16:32,732 - INFO - Step 0: Loss=1.4372, VelCos=0.000, GlobalCos=0.000, EstR@1=0.0%, Quality=needs_improvement, Mem=2.8GB
[Rank 0] 2025-07-23 03:17:12,783 - INFO - Step 88: Loss=1.3625, VelCos=0.001, GlobalCos=0.246, EstR@1=14.7%, Quality=needs_improvement, Mem=4.6GB
[Rank 0] 2025-07-23 03:17:28,193 - INFO - Loaded shard 2/27: 2513 samples
[Rank 0] 2025-07-23 03:17:58,785 - INFO - Step 176: Loss=1.3360, VelCos=0.002, GlobalCos=0.227, EstR@1=13.6%, Quality=needs_improvement, Mem=4.6GB
[Rank 0] 2025-07-23 03:18:21,383 - INFO - Loaded shard 3/27: 2596 samples
