🔄 Weights & Biases initialized:
    Project: unified_3D
    Experiment: alignment_of_eva_clip_20250708_125655
    URL: https://wandb.ai/RecSys-UvA/unified_3D/runs/9072nmff
📚 Loading dataset from embeddings/blip3o_embeddings.pkl
    Train samples: 2381
    Val samples: 265
🚀 Initializing DiT Model for EVA-CLIP → CLIP Translation...
    Input (CLIP L-14): 768D
    Condition (EVA-CLIP): 1280D
    Architecture: original
📋 Original LuminaDiT initialized:
    Architecture: 24 blocks, 16 heads, 1024 dim
    Input: CLIP L-14 (768D) → EVA-CLIP (1280D)
    Optimized for embedding translation tasks
    No spatial assumptions, clean semantic mapping
    Proven stable for EVA-CLIP → CLIP L-14 alignment
    📋 Using Original LuminaDiT Architecture
    🎯 Optimized for embedding-to-embedding translation
    ✅ No spatial assumptions, clean semantic mapping
    🔒 Proven stable for EVA-CLIP → CLIP L-14 alignment
📊 Model Statistics:
    Total parameters: 414,402,304
    Trainable parameters: 414,402,304
    Model size: 1657.6 MB
    Model type: Original_LuminaDiT
🎯 Training Configuration:
    Learning rate: 0.0002
    Epochs: 100
    Batch size: 64
    DiT Architecture: original
    Model Implementation: Original_LuminaDiT
    Loss type: huber
    Scheduler: cosine_restarts
    W&B Logging: Enabled
Epoch 1/100: 100%|██████████| 38/38 [00:04<00:00,  8.81it/s, loss=0.9543, avg_loss=1.7802, align=0.006, lr=2.00e-04, arch=original] 
Epoch 2/100: 100%|██████████| 38/38 [00:03<00:00, 10.62it/s, loss=0.8777, avg_loss=0.9283, align=0.009, lr=1.98e-04, arch=original] 

🧪 Running validation...
    Val loss: 0.8633
    Val alignment: 0.0019
    🎯 New best alignment: 0.0019
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.8633
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 3/100: 100%|██████████| 38/38 [00:04<00:00,  7.80it/s, loss=0.8176, avg_loss=0.8464, align=0.009, lr=1.92e-04, arch=original] 
Epoch 4/100: 100%|██████████| 38/38 [00:03<00:00, 11.02it/s, loss=0.8204, avg_loss=0.8282, align=-0.011, lr=1.82e-04, arch=original]

🧪 Running validation...
    Val loss: 0.8286
    Val alignment: 0.0016
    📉 New best validation loss: 0.8286
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 5/100: 100%|██████████| 38/38 [00:04<00:00,  8.16it/s, loss=0.8112, avg_loss=0.8103, align=-0.011, lr=1.69e-04, arch=original]
💾 Saved model to checkpoints_original/lumina_epoch5.pt
💾 Saved checkpoint to checkpoints_original/lumina_epoch5.pt
Epoch 6/100: 100%|██████████| 38/38 [00:03<00:00, 10.19it/s, loss=0.8137, avg_loss=0.8035, align=0.013, lr=1.52e-04, arch=original] 

🧪 Running validation...
    Val loss: 0.8012
    Val alignment: 0.0073
    🎯 New best alignment: 0.0073
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.8012
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 7/100: 100%|██████████| 38/38 [00:03<00:00, 10.63it/s, loss=0.8136, avg_loss=0.7998, align=-0.007, lr=1.34e-04, arch=original]
Epoch 8/100: 100%|██████████| 38/38 [00:04<00:00,  7.81it/s, loss=0.8014, avg_loss=0.8007, align=0.006, lr=1.15e-04, arch=original] 

🧪 Running validation...
    Val loss: 0.7988
    Val alignment: 0.0056
    📉 New best validation loss: 0.7988
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 9/100: 100%|██████████| 38/38 [00:03<00:00, 10.65it/s, loss=0.8024, avg_loss=0.8018, align=0.008, lr=9.51e-05, arch=original] 
Epoch 10/100: 100%|██████████| 38/38 [00:04<00:00,  8.20it/s, loss=0.7978, avg_loss=0.7976, align=0.004, lr=7.56e-05, arch=original] 

🧪 Running validation...
    Val loss: 0.7962
    Val alignment: 0.0053
    📉 New best validation loss: 0.7962
💾 Saved model to checkpoints_original/best_loss_model.pt
💾 Saved model to checkpoints_original/lumina_epoch10.pt
💾 Saved checkpoint to checkpoints_original/lumina_epoch10.pt
Epoch 11/100: 100%|██████████| 38/38 [00:03<00:00, 10.00it/s, loss=0.8242, avg_loss=0.7972, align=0.010, lr=5.75e-05, arch=original] 
Epoch 12/100: 100%|██████████| 38/38 [00:03<00:00, 10.60it/s, loss=0.7914, avg_loss=0.7934, align=0.006, lr=4.14e-05, arch=original]

🧪 Running validation...
    Val loss: 0.7927
    Val alignment: 0.0054
    📉 New best validation loss: 0.7927
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 13/100: 100%|██████████| 38/38 [00:04<00:00,  8.14it/s, loss=0.7941, avg_loss=0.7911, align=0.011, lr=2.81e-05, arch=original]
Epoch 14/100: 100%|██████████| 38/38 [00:03<00:00, 10.03it/s, loss=0.8029, avg_loss=0.7903, align=0.017, lr=1.82e-05, arch=original]

🧪 Running validation...
    Val loss: 0.7990
    Val alignment: 0.0184
    🎯 New best alignment: 0.0184
💾 Saved model to checkpoints_original/best_alignment_model.pt
Epoch 15/100: 100%|██████████| 38/38 [00:04<00:00,  8.20it/s, loss=0.7927, avg_loss=0.7873, align=0.027, lr=1.21e-05, arch=original]
💾 Saved model to checkpoints_original/lumina_epoch15.pt
💾 Saved checkpoint to checkpoints_original/lumina_epoch15.pt
Epoch 16/100: 100%|██████████| 38/38 [00:03<00:00, 10.00it/s, loss=0.8447, avg_loss=0.8069, align=0.023, lr=2.00e-04, arch=original]

🧪 Running validation...
    Val loss: 0.8187
    Val alignment: 0.0174
Epoch 17/100: 100%|██████████| 38/38 [00:03<00:00, 10.62it/s, loss=0.7876, avg_loss=0.7958, align=0.044, lr=1.98e-04, arch=original]
Epoch 18/100: 100%|██████████| 38/38 [00:04<00:00,  8.15it/s, loss=0.7970, avg_loss=0.8062, align=-0.017, lr=1.92e-04, arch=original]

🧪 Running validation...
    Val loss: 0.7973
    Val alignment: 0.0039
Epoch 19/100: 100%|██████████| 38/38 [00:03<00:00, 10.02it/s, loss=0.7961, avg_loss=0.7980, align=0.026, lr=1.82e-04, arch=original]
Epoch 20/100: 100%|██████████| 38/38 [00:04<00:00,  7.80it/s, loss=0.7926, avg_loss=0.7898, align=0.042, lr=1.69e-04, arch=original]

🧪 Running validation...
    Val loss: 0.7859
    Val alignment: 0.0422
    🎯 New best alignment: 0.0422
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.7859
💾 Saved model to checkpoints_original/best_loss_model.pt
💾 Saved model to checkpoints_original/lumina_epoch20.pt
💾 Saved checkpoint to checkpoints_original/lumina_epoch20.pt
Epoch 21/100: 100%|██████████| 38/38 [00:03<00:00, 10.61it/s, loss=0.7986, avg_loss=0.7915, align=0.013, lr=1.52e-04, arch=original]
Epoch 22/100: 100%|██████████| 38/38 [00:03<00:00, 10.38it/s, loss=0.7804, avg_loss=0.7848, align=0.060, lr=1.34e-04, arch=original]

🧪 Running validation...
    Val loss: 0.7709
    Val alignment: 0.0689
    🎯 New best alignment: 0.0689
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.7709
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 23/100: 100%|██████████| 38/38 [00:04<00:00,  8.27it/s, loss=0.7494, avg_loss=0.7633, align=0.099, lr=1.15e-04, arch=original]
Epoch 24/100: 100%|██████████| 38/38 [00:03<00:00, 10.05it/s, loss=0.7387, avg_loss=0.7495, align=0.145, lr=9.51e-05, arch=original]

🧪 Running validation...
    Val loss: 0.7340
    Val alignment: 0.1297
    🎯 New best alignment: 0.1297
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.7340
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 25/100: 100%|██████████| 38/38 [00:04<00:00,  8.17it/s, loss=0.7262, avg_loss=0.7386, align=0.148, lr=7.56e-05, arch=original]
💾 Saved model to checkpoints_original/lumina_epoch25.pt
💾 Saved checkpoint to checkpoints_original/lumina_epoch25.pt
Epoch 26/100: 100%|██████████| 38/38 [00:03<00:00, 10.60it/s, loss=0.7227, avg_loss=0.7231, align=0.161, lr=5.75e-05, arch=original]

🧪 Running validation...
    Val loss: 0.7253
    Val alignment: 0.1753
    🎯 New best alignment: 0.1753
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.7253
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 27/100: 100%|██████████| 38/38 [00:03<00:00, 10.01it/s, loss=0.7029, avg_loss=0.7129, align=0.202, lr=4.14e-05, arch=original]
Epoch 28/100: 100%|██████████| 38/38 [00:04<00:00,  8.24it/s, loss=0.7124, avg_loss=0.7050, align=0.205, lr=2.81e-05, arch=original]

🧪 Running validation...
    Val loss: 0.7098
    Val alignment: 0.2177
    🎯 New best alignment: 0.2177
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.7098
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 29/100: 100%|██████████| 38/38 [00:03<00:00,  9.76it/s, loss=0.6977, avg_loss=0.6986, align=0.218, lr=1.82e-05, arch=original]
Epoch 30/100: 100%|██████████| 38/38 [00:04<00:00,  8.03it/s, loss=0.6979, avg_loss=0.6951, align=0.228, lr=1.21e-05, arch=original]

🧪 Running validation...
    Val loss: 0.6945
    Val alignment: 0.2336
    🎯 New best alignment: 0.2336
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.6945
💾 Saved model to checkpoints_original/best_loss_model.pt
💾 Saved model to checkpoints_original/lumina_epoch30.pt
💾 Saved checkpoint to checkpoints_original/lumina_epoch30.pt
Epoch 31/100: 100%|██████████| 38/38 [00:03<00:00, 10.99it/s, loss=0.7068, avg_loss=0.7149, align=0.199, lr=2.00e-04, arch=original]
Epoch 32/100: 100%|██████████| 38/38 [00:03<00:00, 10.23it/s, loss=0.7130, avg_loss=0.7086, align=0.182, lr=1.98e-04, arch=original]

🧪 Running validation...
    Val loss: 0.7228
    Val alignment: 0.2100
Epoch 33/100: 100%|██████████| 38/38 [00:04<00:00,  8.16it/s, loss=0.7039, avg_loss=0.6982, align=0.237, lr=1.92e-04, arch=original]
Epoch 34/100: 100%|██████████| 38/38 [00:03<00:00, 10.74it/s, loss=0.6837, avg_loss=0.6885, align=0.237, lr=1.82e-04, arch=original]

🧪 Running validation...
    Val loss: 0.6810
    Val alignment: 0.2636
    🎯 New best alignment: 0.2636
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.6810
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 35/100: 100%|██████████| 38/38 [00:04<00:00,  7.91it/s, loss=0.6693, avg_loss=0.6795, align=0.274, lr=1.69e-04, arch=original]
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 915628608 vs 915628496
🔄 Attempting minimal save...
💥 Critical error saving model: 'model_state_dict'
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/244: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 915628608 vs 915628496

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 136, in safe_save_model
    'model_state_dict': state['model_state_dict'],
                        ~~~~~^^^^^^^^^^^^^^^^^^^^
KeyError: 'model_state_dict'
Epoch 36/100: 100%|██████████| 38/38 [00:03<00:00, 10.61it/s, loss=0.6925, avg_loss=0.6674, align=0.327, lr=1.52e-04, arch=original]

🧪 Running validation...
    Val loss: 0.6594
    Val alignment: 0.3109
    🎯 New best alignment: 0.3109
💾 Saved model to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.6594
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 37/100: 100%|██████████| 38/38 [00:03<00:00, 10.37it/s, loss=0.6497, avg_loss=0.6569, align=0.331, lr=1.34e-04, arch=original]
Epoch 38/100: 100%|██████████| 38/38 [00:04<00:00,  8.39it/s, loss=0.6490, avg_loss=0.6473, align=0.334, lr=1.15e-04, arch=original]

🧪 Running validation...
    Val loss: 0.6512
    Val alignment: 0.3437
    🎯 New best alignment: 0.3437
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 4970093184 vs 4970093080
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.6512
💾 Saved model to checkpoints_original/best_loss_model.pt
Epoch 39/100: 100%|██████████| 38/38 [00:03<00:00, 10.75it/s, loss=0.6258, avg_loss=0.6407, align=0.372, lr=9.51e-05, arch=original]
Epoch 40/100: 100%|██████████| 38/38 [00:04<00:00,  7.88it/s, loss=0.6159, avg_loss=0.6299, align=0.371, lr=7.56e-05, arch=original]

🧪 Running validation...
    Val loss: 0.6245
    Val alignment: 0.3778
    🎯 New best alignment: 0.3778
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 4127085056 vs 4127084948
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_original/best_alignment_model.pt
    📉 New best validation loss: 0.6245
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 2695065472 vs 2695065360
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_original/best_loss_model.pt
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 294137664 vs 294137552
🔄 Attempting minimal save...
💥 Critical error saving model: 'model_state_dict'
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/78: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
