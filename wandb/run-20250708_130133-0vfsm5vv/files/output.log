üîÑ Weights & Biases initialized:
    Project: unified_3D
    Experiment: alignment_of_eva_clip_20250708_130133
    URL: https://wandb.ai/RecSys-UvA/unified_3D/runs/0vfsm5vv
üìö Loading dataset from embeddings/blip3o_embeddings.pkl
    Train samples: 2381
    Val samples: 265
üöÄ Initializing DiT Model for EVA-CLIP ‚Üí CLIP Translation...
    Input (CLIP L-14): 768D
    Condition (EVA-CLIP): 1280D
    Architecture: enhanced
    üéØ Attention config: 16 heads, 8 KV heads
üöÄ Enhanced LuminaDiT (Lumina-Next) initialized:
    Architecture: 24 blocks, 16 heads, 1024 dim
    Input: CLIP L-14 (768D) ‚Üí EVA-CLIP (1280D)
    AdaLN-Zero: Enabled for proper time conditioning
    Grouped QA: 16/8 heads
    KQ-Norm: Enabled
    Zero-init: Enabled for training stability
    SwiGLU: Modern transformer activation
    ‚ú® Using Enhanced DiT Architecture (Lumina-Next)
    üîÑ AdaLN-Zero: Enabled for proper time conditioning
    üéØ Grouped Query Attention: 16/8 heads
    üõ°Ô∏è KQ-Norm: Enabled for training stability
    üîß Zero-init: Enabled for output projections
    üöÄ SwiGLU: Modern transformer activation
üìä Model Statistics:
    Total parameters: 464,493,312
    Trainable parameters: 464,493,312
    Model size: 1858.0 MB
    Model type: Enhanced_LuminaNext
üéØ Training Configuration:
    Learning rate: 0.0002
    Epochs: 100
    Batch size: 64
    DiT Architecture: enhanced
    Model Implementation: Enhanced_LuminaNext
    Loss type: huber
    Scheduler: cosine_restarts
    W&B Logging: Enabled
Epoch 1/100: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 38/38 [00:07<00:00,  5.35it/s, loss=1.1171, avg_loss=1.4570, align=0.022, lr=2.00e-04, arch=enhanced]
Epoch 2/100: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 38/38 [00:06<00:00,  6.30it/s, loss=1.1391, avg_loss=1.3701, align=0.034, lr=1.98e-04, arch=enhanced]

üß™ Running validation...
    Val loss: 1.1997
    Val alignment: 0.0249
    üéØ New best alignment: 0.0249
üíæ Saved model to checkpoints_enhanced/best_alignment_model.pt
    üìâ New best validation loss: 1.1997
‚ùå Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 1401960320 vs 1401960208
üîÑ Attempting minimal save...
üí• Critical error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 730349760 vs 730349648
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/431: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 1401960320 vs 1401960208

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/227: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 143, in safe_save_model
    torch.save(minimal_state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 730349760 vs 730349648
‚ùå Could not save best loss model!
Epoch 3/100: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 38/38 [00:08<00:00,  4.51it/s, loss=1.0535, avg_loss=1.1990, align=0.032, lr=1.92e-04, arch=enhanced]
Epoch 4/100: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 38/38 [00:05<00:00,  6.37it/s, loss=0.8611, avg_loss=1.0232, align=-0.008, lr=1.82e-04, arch=enhanced]

üß™ Running validation...
    Val loss: 0.8606
    Val alignment: 0.0128
    üìâ New best validation loss: 0.8606
‚ùå Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 730504576 vs 730504464
üîÑ Attempting minimal save...
üí• Critical error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 730349760 vs 730349648
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/227: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 730504576 vs 730504464

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/227: file write failed

