🔄 Weights & Biases initialized:
    Project: unified_3D
    Experiment: alignment_of_eva_clip_20250708_132604
    URL: https://wandb.ai/RecSys-UvA/unified_3D/runs/8d2qrhww
📚 Loading dataset from embeddings/blip3o_embeddings.pkl
    Train samples: 2381
    Val samples: 265
🚀 Initializing DiT Model for EVA-CLIP → CLIP Translation...
    Input (CLIP L-14): 768D
    Condition (EVA-CLIP): 1280D
    Architecture: enhanced
    🎯 Attention config: 16 heads, 8 KV heads
🚀 Enhanced LuminaDiT (Lumina-Next) initialized:
    Architecture: 24 blocks, 16 heads, 1024 dim
    Input: CLIP L-14 (768D) → EVA-CLIP (1280D)
    AdaLN-Zero: Enabled for proper time conditioning
    Grouped QA: 16/8 heads
    KQ-Norm: Enabled
    Zero-init: Enabled for training stability
    SwiGLU: Modern transformer activation
    ✨ Using Enhanced DiT Architecture (Lumina-Next)
    🔄 AdaLN-Zero: Enabled for proper time conditioning
    🎯 Grouped Query Attention: 16/8 heads
    🛡️ KQ-Norm: Enabled for training stability
    🔧 Zero-init: Enabled for output projections
    🚀 SwiGLU: Modern transformer activation
📊 Model Statistics:
    Total parameters: 464,493,312
    Trainable parameters: 464,493,312
    Model size: 1858.0 MB
    Model type: Enhanced_LuminaNext
🎯 Training Configuration:
    Learning rate: 0.0002
    Epochs: 100
    Batch size: 64
    DiT Architecture: enhanced
    Model Implementation: Enhanced_LuminaNext
    Loss type: huber
    Scheduler: cosine_restarts
    W&B Logging: Enabled
Epoch 1/100: 100%|██████████| 38/38 [00:06<00:00,  5.60it/s, loss=1.2131, avg_loss=1.3437, align=0.028, lr=2.00e-04, arch=enhanced]
Epoch 2/100: 100%|██████████| 38/38 [00:06<00:00,  6.30it/s, loss=1.2470, avg_loss=1.2721, align=0.034, lr=1.98e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 2.1095
    Val alignment: 0.0396
    🎯 New best alignment: 0.0396
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 2.1095
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 3/100: 100%|██████████| 38/38 [00:08<00:00,  4.50it/s, loss=1.0328, avg_loss=1.2280, align=0.053, lr=1.92e-04, arch=enhanced]
Epoch 4/100: 100%|██████████| 38/38 [00:06<00:00,  6.25it/s, loss=0.9113, avg_loss=0.9917, align=0.006, lr=1.82e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.9168
    Val alignment: 0.0174
    📉 New best validation loss: 0.9168
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 5/100: 100%|██████████| 38/38 [00:07<00:00,  5.06it/s, loss=0.8699, avg_loss=0.8837, align=0.030, lr=1.69e-04, arch=enhanced] 
💾 Saved model to checkpoints_enhanced/lumina_epoch5.pt
💾 Saved checkpoint to checkpoints_enhanced/lumina_epoch5.pt
Epoch 6/100: 100%|██████████| 38/38 [00:06<00:00,  6.01it/s, loss=0.7970, avg_loss=0.8308, align=0.017, lr=1.52e-04, arch=enhanced] 

🧪 Running validation...
    Val loss: 0.8365
    Val alignment: 0.0064
    📉 New best validation loss: 0.8365
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 7/100: 100%|██████████| 38/38 [00:06<00:00,  6.26it/s, loss=0.8082, avg_loss=0.8107, align=0.006, lr=1.34e-04, arch=enhanced]
Epoch 8/100: 100%|██████████| 38/38 [00:07<00:00,  4.98it/s, loss=0.7918, avg_loss=0.8032, align=0.014, lr=1.15e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.8163
    Val alignment: 0.0195
    📉 New best validation loss: 0.8163
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 9/100: 100%|██████████| 38/38 [00:06<00:00,  6.30it/s, loss=0.8233, avg_loss=0.7961, align=0.041, lr=9.51e-05, arch=enhanced]
Epoch 10/100: 100%|██████████| 38/38 [00:07<00:00,  5.13it/s, loss=0.7757, avg_loss=0.7864, align=0.073, lr=7.56e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.7775
    Val alignment: 0.0635
    🎯 New best alignment: 0.0635
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.7775
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
💾 Saved model to checkpoints_enhanced/lumina_epoch10.pt
💾 Saved checkpoint to checkpoints_enhanced/lumina_epoch10.pt
Epoch 11/100: 100%|██████████| 38/38 [00:06<00:00,  6.01it/s, loss=0.7883, avg_loss=0.7768, align=0.087, lr=5.75e-05, arch=enhanced]
Epoch 12/100: 100%|██████████| 38/38 [00:06<00:00,  6.28it/s, loss=0.7589, avg_loss=0.7679, align=0.097, lr=4.14e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.7662
    Val alignment: 0.0916
    🎯 New best alignment: 0.0916
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.7662
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 13/100: 100%|██████████| 38/38 [00:07<00:00,  5.12it/s, loss=0.7523, avg_loss=0.7608, align=0.091, lr=2.81e-05, arch=enhanced]
Epoch 14/100: 100%|██████████| 38/38 [00:06<00:00,  5.97it/s, loss=0.7436, avg_loss=0.7549, align=0.133, lr=1.82e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.7547
    Val alignment: 0.1221
    🎯 New best alignment: 0.1221
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.7547
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 15/100: 100%|██████████| 38/38 [00:07<00:00,  5.13it/s, loss=0.7579, avg_loss=0.7527, align=0.124, lr=1.21e-05, arch=enhanced]
💾 Saved model to checkpoints_enhanced/lumina_epoch15.pt
💾 Saved checkpoint to checkpoints_enhanced/lumina_epoch15.pt
Epoch 16/100: 100%|██████████| 38/38 [00:06<00:00,  5.99it/s, loss=0.7674, avg_loss=0.7625, align=0.138, lr=2.00e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.7561
    Val alignment: 0.1263
    🎯 New best alignment: 0.1263
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
Epoch 17/100: 100%|██████████| 38/38 [00:06<00:00,  6.25it/s, loss=0.7536, avg_loss=0.7498, align=0.152, lr=1.98e-04, arch=enhanced]
Epoch 18/100: 100%|██████████| 38/38 [00:07<00:00,  5.09it/s, loss=0.7628, avg_loss=0.7420, align=0.183, lr=1.92e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.7318
    Val alignment: 0.1831
    🎯 New best alignment: 0.1831
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.7318
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 19/100: 100%|██████████| 38/38 [00:06<00:00,  6.02it/s, loss=0.7112, avg_loss=0.7271, align=0.207, lr=1.82e-04, arch=enhanced]
Epoch 20/100: 100%|██████████| 38/38 [00:07<00:00,  5.10it/s, loss=0.7347, avg_loss=0.7170, align=0.226, lr=1.69e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.7192
    Val alignment: 0.2205
    🎯 New best alignment: 0.2205
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.7192
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
💾 Saved model to checkpoints_enhanced/lumina_epoch20.pt
💾 Saved checkpoint to checkpoints_enhanced/lumina_epoch20.pt
Epoch 21/100: 100%|██████████| 38/38 [00:06<00:00,  6.27it/s, loss=0.7049, avg_loss=0.7050, align=0.230, lr=1.52e-04, arch=enhanced]
Epoch 22/100: 100%|██████████| 38/38 [00:06<00:00,  5.99it/s, loss=0.6813, avg_loss=0.6923, align=0.285, lr=1.34e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6862
    Val alignment: 0.2732
    🎯 New best alignment: 0.2732
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6862
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 23/100: 100%|██████████| 38/38 [00:07<00:00,  5.11it/s, loss=0.6711, avg_loss=0.6847, align=0.292, lr=1.15e-04, arch=enhanced]
Epoch 24/100: 100%|██████████| 38/38 [00:06<00:00,  6.00it/s, loss=0.6876, avg_loss=0.6741, align=0.304, lr=9.51e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6849
    Val alignment: 0.3018
    🎯 New best alignment: 0.3018
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6849
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 25/100: 100%|██████████| 38/38 [00:07<00:00,  5.11it/s, loss=0.6852, avg_loss=0.6682, align=0.313, lr=7.56e-05, arch=enhanced]
💾 Saved model to checkpoints_enhanced/lumina_epoch25.pt
💾 Saved checkpoint to checkpoints_enhanced/lumina_epoch25.pt
Epoch 26/100: 100%|██████████| 38/38 [00:06<00:00,  6.24it/s, loss=0.6678, avg_loss=0.6604, align=0.308, lr=5.75e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6603
    Val alignment: 0.3260
    🎯 New best alignment: 0.3260
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6603
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 27/100: 100%|██████████| 38/38 [00:06<00:00,  6.00it/s, loss=0.6554, avg_loss=0.6550, align=0.336, lr=4.14e-05, arch=enhanced]
Epoch 28/100: 100%|██████████| 38/38 [00:07<00:00,  5.12it/s, loss=0.6526, avg_loss=0.6504, align=0.330, lr=2.81e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6502
    Val alignment: 0.3507
    🎯 New best alignment: 0.3507
💾 Saved model to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6502
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 29/100: 100%|██████████| 38/38 [00:06<00:00,  6.02it/s, loss=0.6492, avg_loss=0.6467, align=0.327, lr=1.82e-05, arch=enhanced]
Epoch 30/100: 100%|██████████| 38/38 [00:07<00:00,  5.10it/s, loss=0.6467, avg_loss=0.6436, align=0.344, lr=1.21e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6464
    Val alignment: 0.3479
    📉 New best validation loss: 0.6464
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 1636964224 vs 1636964112
🔄 Attempting minimal save...
💥 Critical error saving model: 'model_state_dict'
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/503: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 1636964224 vs 1636964112

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 136, in safe_save_model
    'model_state_dict': state['model_state_dict'],
                        ~~~~~^^^^^^^^^^^^^^^^^^^^
KeyError: 'model_state_dict'
Epoch 31/100: 100%|██████████| 38/38 [00:06<00:00,  6.27it/s, loss=0.6643, avg_loss=0.6590, align=0.322, lr=2.00e-04, arch=enhanced]
Epoch 32/100: 100%|██████████| 38/38 [00:06<00:00,  6.04it/s, loss=0.6515, avg_loss=0.6619, align=0.326, lr=1.98e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6657
    Val alignment: 0.3222
Epoch 33/100: 100%|██████████| 38/38 [00:07<00:00,  5.08it/s, loss=0.6573, avg_loss=0.6578, align=0.335, lr=1.92e-04, arch=enhanced]
Epoch 34/100: 100%|██████████| 38/38 [00:06<00:00,  6.22it/s, loss=0.6441, avg_loss=0.6470, align=0.360, lr=1.82e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6454
    Val alignment: 0.3527
    🎯 New best alignment: 0.3527
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 5571315712 vs 5571315608
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6454
💾 Saved model to checkpoints_enhanced/best_loss_model.pt
Epoch 35/100: 100%|██████████| 38/38 [00:07<00:00,  4.96it/s, loss=0.6604, avg_loss=0.6422, align=0.354, lr=1.69e-04, arch=enhanced]
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 3688097152 vs 3688097040
🔄 Attempting minimal save...
💥 Critical error saving model: 'model_state_dict'
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/1411: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 3688097152 vs 3688097040

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 136, in safe_save_model
    'model_state_dict': state['model_state_dict'],
                        ~~~~~^^^^^^^^^^^^^^^^^^^^
KeyError: 'model_state_dict'
Epoch 36/100: 100%|██████████| 38/38 [00:06<00:00,  6.24it/s, loss=0.6317, avg_loss=0.6312, align=0.368, lr=1.52e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6313
    Val alignment: 0.3913
    🎯 New best alignment: 0.3913
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 1861451392 vs 1861451280
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6313
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 5571315712 vs 5571315608
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_loss_model.pt
Epoch 37/100: 100%|██████████| 38/38 [00:06<00:00,  6.02it/s, loss=0.6143, avg_loss=0.6226, align=0.382, lr=1.34e-04, arch=enhanced]
Epoch 38/100: 100%|██████████| 38/38 [00:07<00:00,  5.09it/s, loss=0.6197, avg_loss=0.6160, align=0.400, lr=1.15e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6138
    Val alignment: 0.4023
    🎯 New best alignment: 0.4023
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 5571315712 vs 5571315608
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.6138
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 5571315712 vs 5571315608
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_loss_model.pt
Epoch 39/100: 100%|██████████| 38/38 [00:06<00:00,  6.24it/s, loss=0.6060, avg_loss=0.6077, align=0.424, lr=9.51e-05, arch=enhanced]
Epoch 40/100: 100%|██████████| 38/38 [00:07<00:00,  4.95it/s, loss=0.5962, avg_loss=0.6010, align=0.438, lr=7.56e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.5968
    Val alignment: 0.4458
    🎯 New best alignment: 0.4458
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 5568169856 vs 5568169756
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.5968
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 5551383808 vs 5551383704
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_loss_model.pt
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 3688097152 vs 3688097040
🔄 Attempting minimal save...
💥 Critical error saving model: 'model_state_dict'
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/1411: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 3688097152 vs 3688097040

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 136, in safe_save_model
    'model_state_dict': state['model_state_dict'],
                        ~~~~~^^^^^^^^^^^^^^^^^^^^
KeyError: 'model_state_dict'
Epoch 41/100: 100%|██████████| 38/38 [00:06<00:00,  6.21it/s, loss=0.5964, avg_loss=0.5949, align=0.449, lr=5.75e-05, arch=enhanced]
Epoch 42/100: 100%|██████████| 38/38 [00:06<00:00,  6.24it/s, loss=0.5909, avg_loss=0.5908, align=0.452, lr=4.14e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.5914
    Val alignment: 0.4583
    🎯 New best alignment: 0.4583
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 1861451392 vs 1861451280
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_alignment_model.pt
    📉 New best validation loss: 0.5914
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 1864605952 vs 1864605844
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_loss_model.pt
Epoch 43/100: 100%|██████████| 38/38 [00:06<00:00,  5.99it/s, loss=0.5824, avg_loss=0.5857, align=0.465, lr=2.81e-05, arch=enhanced]
Epoch 44/100: 100%|██████████| 38/38 [00:06<00:00,  6.23it/s, loss=0.5879, avg_loss=0.5831, align=0.450, lr=1.82e-05, arch=enhanced]

🧪 Running validation...
    Val loss: 0.5874
    Val alignment: 0.4562
    📉 New best validation loss: 0.5874
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 1861451392 vs 1861451280
🔄 Attempting minimal save...
💾 Minimal model saved to checkpoints_enhanced/best_loss_model.pt
Epoch 45/100: 100%|██████████| 38/38 [00:07<00:00,  4.95it/s, loss=0.5866, avg_loss=0.5811, align=0.473, lr=1.21e-05, arch=enhanced]
❌ Error saving model: [enforce fail at inline_container.cc:659] . unexpected pos 260096 vs 259990
🔄 Attempting minimal save...
💥 Critical error saving model: 'model_state_dict'
Traceback (most recent call last):
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 965, in save
    _save(
    ~~~~~^
        obj,
        ^^^^
    ...<3 lines>...
        _disable_byteorder_record,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 1266, in _save
    zip_file.write_record(name, storage, num_bytes)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: [enforce fail at inline_container.cc:857] . PytorchStreamWriter failed writing file data/0: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 126, in safe_save_model
    torch.save(state, path)
    ~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 964, in save
    with _open_zipfile_writer(f) as opened_zipfile:
         ~~~~~~~~~~~~~~~~~~~~^^^
  File "/home/scur2711/.conda/envs/eva_clip_env/lib/python3.13/site-packages/torch/serialization.py", line 798, in __exit__
    self.file_like.write_end_of_file()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: [enforce fail at inline_container.cc:659] . unexpected pos 260096 vs 259990

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/home1/scur2711/eva-clip-flow-matching/eva-clip-v3/train_flow_matching.py", line 136, in safe_save_model
    'model_state_dict': state['model_state_dict'],
                        ~~~~~^^^^^^^^^^^^^^^^^^^^
KeyError: 'model_state_dict'
Epoch 46/100: 100%|██████████| 38/38 [00:06<00:00,  6.23it/s, loss=0.6183, avg_loss=0.5999, align=0.432, lr=2.00e-04, arch=enhanced]

🧪 Running validation...
    Val loss: 0.6231
    Val alignment: 0.4464
Epoch 47/100:  53%|█████▎    | 20/38 [00:03<00:02,  6.41it/s, loss=0.6075, avg_loss=0.6079, align=0.417, lr=1.98e-04, arch=enhanced]
